# 面试题 - 系统集成

> 系统集成类面试题

---

## 1. 第三方对接

### Q1: 你是如何与第三方系统对接的？

**参考回答**：

1. **分析接口文档**
   - 理解接口规范
   - 分析数据格式
   - 确认认证方式

2. **设计对接方案**
   - 统一的数据模型
   - 适配器模式转换
   - 异常处理机制

3. **实现对接**
   - 开发API Client
   - 实现数据转换
   - 编写单元测试

**实际案例**：
在万物云对接项目中，我分析了预算系统和采购系统的接口文档，设计了统一的DataSyncAdapter接口，开发了具体的适配器实现，实现了数据转换和对接。

---

### Q2: 第三方接口调用失败如何处理？

**参考回答**：

1. **自动重试**
   - 指数退避重试
   - 限制重试次数
   - 记录重试日志

2. **降级处理**
   - 返回默认值
   - 使用缓存数据
   - 提示用户稍后重试

3. **告警通知**
   - 发送告警消息
   - 记录失败日志
   - 统计失败率

**代码示例**：
```java
public <T> T callWithRetry(Callable<T> callable, int maxRetry) {
    int retry = 0;
    while (retry < maxRetry) {
        try {
            return callable.call();
        } catch (Exception e) {
            retry++;
            if (retry >= maxRetry) {
                throw e;
            }
            Thread.sleep((long) Math.pow(2, retry) * 1000);
        }
    }
    return null;
}
```

---

## 2. 接口设计

### Q3: 你是如何设计RESTful API的？

**参考回答**：

1. **资源导向**
   - URL表示资源
   - HTTP方法表示操作
   - 统一的资源命名

2. **标准HTTP方法**
   - GET：查询
   - POST：创建
   - PUT：更新
   - DELETE：删除

3. **统一返回格式**
   - 包含状态码
   - 包含消息
   - 包含数据

**实际案例**：
在ERP系统中，我设计的设备管理接口：
- GET /api/devices/{id} - 查询设备
- POST /api/devices - 创建设备
- PUT /api/devices/{id} - 更新设备
- DELETE /api/devices/{id} - 删除设备

---

### Q4: 接口版本控制是如何设计的？

**参考回答**：

1. **URL版本控制**
   - /api/v1/devices
   - /api/v2/devices

2. **Header版本控制**
   - Accept: application/vnd.api.v1+json

3. **兼容性设计**
   - 向后兼容
   - 标记已废弃
   - 提供迁移指南

**实际案例**：
在ERP系统中，我使用URL版本控制，实现了v1和v2两个版本。v1支持基础功能，v2增加了字段扩展，保持了向后兼容。

---

## 3. 数据一致性

### Q5: 多系统集成中如何保证数据一致性？

**参考回答**：

1. **本地消息表**
   - 写入本地消息表
   - 异步同步到第三方
   - 记录同步状态

2. **事务机制**
   - 本数据库事务
   - 第三方调用失败补偿
   - 定时任务重试

3. **最终一致性**
   - 允许短暂不一致
   - 通过重试达到一致
   - 记录不一致数据

**实际案例**：
在万物云对接中，我使用本地消息表记录同步任务，定时任务扫描失败的消息重试，保证数据最终一致。

---

### Q6: 分布式事务是如何实现的？

**参考回答**：

1. **2PC/XA**
   - 两阶段提交
   - 强一致性
   - 性能较差

2. **TCC**
   - Try：预留资源
   - Confirm：确认提交
   - Cancel：取消

3. **Saga**
   - 长事务拆分
   - 补偿事务
   - 最终一致性

4. **本地消息表（推荐）**
   - 实现简单
   - 可靠性高
   - 最终一致性

---

## 4. 异常处理

### Q7: 系统间接口超时如何处理？

**参考回答**：

1. **设置超时时间**
   - 连接超时
   - 读取超时
   - 避免长时间阻塞

2. **异步处理**
   - 使用消息队列
   - 异步调用接口
   - 结果通过回调通知

3. **降级策略**
   - 返回缓存数据
   - 返回默认值
   - 提示用户稍后

---

### Q8: 如何保证接口幂等性？

**参考回答**：

1. **唯一标识**
   - 请求携带唯一ID
   - 服务端记录已处理ID
   - Redis存储

2. **乐观锁**
   - 版本号控制
   - CAS更新

3. **数据库唯一索引**
   - 业务ID唯一
   - 唯一约束

**代码示例**：
```java
public boolean process(String messageId, Runnable task) {
    String key = "processed:" + messageId;
    Boolean locked = redisTemplate.opsForValue().setIfAbsent(key, "1", 24, TimeUnit.HOURS);
    if (Boolean.FALSE.equals(locked)) {
        return false;
    }
    try {
        task.run();
        return true;
    } catch (Exception e) {
        redisTemplate.delete(key);
        throw e;
    }
}
```

---

## 5. 数据安全

### Q9: 接口数据如何加密传输？

**参考回答**：

1. **HTTPS**
   - SSL/TLS加密
   - 证书验证

2. **数据加密**
   - AES加密敏感数据
   - 非对称加密密钥

3. **签名验证**
   - MD5/SHA签名
   - 防止篡改

**实际案例**：
在ERP系统的Android端接口中，我使用了HTTPS加密传输，对设备ID等敏感数据使用AES加密，并添加了签名验证防止数据篡改。

---

### Q10: 接口鉴权是如何实现的？

**参考回答**：

1. **Token认证**
   - JWT Token
   - OAuth2.0
   - Session

2. **权限校验**
   - 拦截器校验
   - 注解校验
   - 权限配置

3. **Token刷新**
   - 刷新Token机制
   - 过期自动刷新

---

## 🔥 补充问题

1. 你是如何做接口压力测试的？
2. 如何监控第三方接口？
3. 接口限流是如何实现的？
4. 如何设计接口文档？
5. 如何做接口兼容性测试？

---

**建议结合万物云对接项目来回答这些问题。**