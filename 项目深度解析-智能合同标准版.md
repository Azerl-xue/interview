# é¡¹ç›®æ·±åº¦è§£æ - æ™ºèƒ½åˆåŒæ ‡å‡†ç‰ˆ

> ä¼ä¸šçº§åˆåŒå…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ç³»ç»Ÿ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**ï¼šæ™ºèƒ½åˆåŒ2.0æ ‡å‡†ç‰ˆ  
**é¡¹ç›®è§’è‰²**ï¼šåç«¯ç ”å‘å·¥ç¨‹å¸ˆ  
**å¼€å‘æ—¶é—´**ï¼š2024.06 - è‡³ä»Š  
**æŠ€æœ¯æ ˆ**ï¼šJava 17ã€Spring Bootã€MyBatisã€MySQLã€Redisã€Dockerã€Maven  
**éƒ¨ç½²æ–¹å¼**ï¼šDockerå®¹å™¨åŒ–éƒ¨ç½²ï¼ˆSaaSï¼‰

---

## ğŸ¯ é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡

### èƒŒæ™¯

ä¼ä¸šåˆåŒç®¡ç†åˆ†æ•£ï¼Œç¼ºä¹ç»Ÿä¸€ç®¡ç†ï¼Œå¯¼è‡´ï¼š
- åˆåŒå¤„ç†æ•ˆç‡ä½
- ç¼ºä¹å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å®¡æ‰¹æµç¨‹ä¸é€æ˜
- å½’æ¡£æ£€ç´¢å›°éš¾

### ç›®æ ‡

- æ„å»ºåˆåŒå…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ç³»ç»Ÿ
- å®ç°åœ¨çº¿ç¼–è¾‘ä¸æ¨¡æ¿ç®¡ç†
- æä¾›æ ‡å‡†åŒ–å®¡æ‰¹æµç¨‹
- æ”¯æŒSaaSåŒ–éƒ¨ç½²

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å‰ç«¯åº”ç”¨                     â”‚
â”‚  åˆåŒèµ·è‰ | åœ¨çº¿ç¼–è¾‘ | å®¡æ‰¹æµç¨‹ | å½’æ¡£   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘
                    â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Spring Bootåç«¯                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åˆåŒç®¡ç†æ¨¡å—                       â”‚   â”‚
â”‚  â”‚ æ¨¡æ¿ç®¡ç†æ¨¡å—                       â”‚   â”‚
â”‚  â”‚ å®¡æ‰¹æµç¨‹æ¨¡å—                       â”‚   â”‚
â”‚  â”‚ ç”µå­ç­¾ç« æ¨¡å—                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“           â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  MySQL  â”‚  â”‚  Redis  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—åˆ’åˆ†

1. **åˆåŒèµ·è‰æ¨¡å—**
   - åœ¨çº¿ç¼–è¾‘å™¨
   - æ¨¡æ¿é€‰æ‹©
   - å˜é‡æ›¿æ¢

2. **å®¡æ‰¹æµç¨‹æ¨¡å—**
   - æµç¨‹é…ç½®
   - å¤šçº§å®¡æ‰¹
   - æµç¨‹è¿½è¸ª

3. **æ¨¡æ¿ç®¡ç†æ¨¡å—**
   - æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶
   - æ¨¡æ¿åˆ†ç±»
   - æƒé™æ§åˆ¶

4. **å½’æ¡£ç®¡ç†æ¨¡å—**
   - åˆåŒå½’æ¡£
   - æ£€ç´¢æŸ¥è¯¢
   - ç”ŸæˆæŠ¥è¡¨

---

## ğŸ”‘ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. åˆåŒå…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### çŠ¶æ€æœºè®¾è®¡

```java
public enum ContractStatus {
    DRAFT,           // è‰ç¨¿
    SUBMITTED,        // å·²æäº¤
    APPROVING,       // å®¡æ‰¹ä¸­
    APPROVED,         // å·²å®¡æ‰¹
    REJECTED,         // å·²æ‹’ç»
    SIGNED,           // å·²ç­¾ç½²
    ARCHIVED          // å·²å½’æ¡£
}

public enum ContractEvent {
    SUBMIT,           // æäº¤
    APPROVE,          // å®¡æ‰¹
    REJECT,           // æ‹’ç»
    SIGN,             // ç­¾ç½²
    ARCHIVE           // å½’æ¡£
}
```

#### çŠ¶æ€è½¬æ¢

```java
@Service
public class ContractStateMachine {
    
    private Map<ContractStatus, Set<ContractEvent>> transitions = new HashMap<>();
    
    public ContractStateMachine() {
        transitions.put(ContractStatus.DRAFT, 
            Set.of(ContractEvent.SUBMIT));
        transitions.put(ContractStatus.SUBMITTED, 
            Set.of(ContractEvent.APPROVE, ContractEvent.REJECT));
        transitions.put(ContractStatus.APPROVING, 
            Set.of(ContractEvent.APPROVE, ContractEvent.REJECT));
        transitions.put(ContractStatus.APPROVED, 
            Set.of(ContractEvent.SIGN));
        transitions.put(ContractStatus.SIGNED, 
            Set.of(ContractEvent.ARCHIVE));
    }
    
    public boolean canTransition(ContractStatus current, ContractEvent event) {
        Set<ContractEvent> allowedEvents = transitions.get(current);
        return allowedEvents != null && allowedEvents.contains(event);
    }
}
```

### 2. å®¡æ‰¹æµç¨‹å¼•æ“

#### æµç¨‹é…ç½®

```java
public class ApprovalProcessConfig {
    private String processId;
    private List<ApprovalNode> nodes;
}

public class ApprovalNode {
    private String nodeId;
    private String nodeName;
    private List<String> approvers;
    private ApprovalType type;
    private String nextNode;
}
```

#### æµç¨‹æ‰§è¡Œ

```java
@Service
public class ApprovalProcessService {
    
    @Autowired
    private ApprovalProcessConfigMapper configMapper;
    
    @Autowired
    private ApprovalRecordMapper recordMapper;
    
    @Transactional(rollbackFor = Exception.class)
    public void processApproval(Long contractId, Long approverId, boolean approved) {
        Contract contract = contractMapper.selectById(contractId);
        ApprovalProcessConfig config = configMapper.selectByType(
            contract.getType());
        
        ApprovalNode currentNode = findCurrentNode(contract, config);
        
        if (approved) {
            if (currentNode.getNextNode() == null) {
                contract.setStatus(ContractStatus.APPROVED);
            } else {
                ApprovalNode nextNode = findNodeById(
                    currentNode.getNextNode(), config);
                contract.setCurrentNode(nextNode.getNodeId());
            }
        } else {
            contract.setStatus(ContractStatus.REJECTED);
        }
        
        contractMapper.updateById(contract);
        
        ApprovalRecord record = new ApprovalRecord();
        record.setContractId(contractId);
        record.setApprover(approverId);
        record.setApproved(approved);
        recordMapper.insert(record);
    }
}
```

### 3. æ¨¡æ¿ç‰ˆæœ¬ç®¡ç†

#### æ¨¡æ¿ç‰ˆæœ¬

```sql
CREATE TABLE `contract_template` (
  `id` BIGINT PRIMARY KEY AUTO_INCREMENT,
  `template_code` VARCHAR(50) NOT NULL,
  `template_name` VARCHAR(100) NOT NULL,
  `version` INT NOT NULL DEFAULT 1,
  `content` TEXT COMMENT 'æ¨¡æ¿å†…å®¹',
  `status` VARCHAR(20) DEFAULT 'ACTIVE',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  UNIQUE KEY `uk_code_version` (`template_code`, `version`),
  INDEX `idx_template_code` (`template_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### ç‰ˆæœ¬æ§åˆ¶

```java
@Service
public class TemplateVersionService {
    
    @Transactional(rollbackFor = Exception.class)
    public void createNewVersion(String templateCode, String newContent) {
        ContractTemplate template = templateMapper.selectLatestByCode(templateCode);
        
        ContractTemplate newVersion = new ContractTemplate();
        newVersion.setTemplateCode(templateCode);
        newVersion.setVersion(template.getVersion() + 1);
        newVersion.setContent(newContent);
        newVersion.setStatus("ACTIVE");
        
        templateMapper.insert(newVersion);
        
        template.setStatus("INACTIVE");
        templateMapper.updateById(template);
    }
}
```

### 4. åˆåŒå˜é‡æ›¿æ¢

#### å˜é‡å®šä¹‰

```java
public class ContractVariable {
    private String key;       // ${company_name}
    private String name;      // å…¬å¸åç§°
    private String type;      // TEXT/DATE/NUMBER
    private String defaultValue;
    private boolean required;
}
```

#### å˜é‡æ›¿æ¢å®ç°

```java
@Service
public class ContractVariableService {
    
    public String replaceVariables(String template, Map<String, Object> values) {
        Pattern pattern = Pattern.compile("\\$\\{(.*?)\\}");
        Matcher matcher = = pattern.matcher(template);
        StringBuffer result = new StringBuffer();
        
        while (matcher.find()) {
            String key = matcher.group(1);
            Object value = values.get(key);
            matcher.appendReplacement(result, value != null ? value.toString() : "");
        }
        matcher.appendTail(result);
        
        return result.toString();
    }
}
```

---

## ğŸ“Š æ ¸å¿ƒæˆæœ

### ç³»ç»Ÿèƒ½åŠ›

- åˆåŒå¤„ç†æ•ˆç‡æå‡30%
- æ”¯æŒå¤šå®¢æˆ·SaaSåŒ–éƒ¨ç½²
- æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶
- çµæ´»çš„å®¡æ‰¹æµç¨‹é…ç½®

### ä¸“åˆ©æˆæœ

- ç”³è¯·1é¡¹æ–‡æ¡£å¤„ç†ç›¸å…³ä¸“åˆ©
- æŠ€æœ¯åˆ›æ–°ï¼šæ–‡æ¡£è§£æä¸å¤„ç†
- åº”ç”¨ä»·å€¼ï¼šæå‡åˆåŒå¤„ç†æ•ˆç‡

---

## ğŸ“ é¢è¯•é‡ç‚¹

### æŠ€æœ¯äº®ç‚¹

1. **çŠ¶æ€æœºè®¾è®¡**
   - åˆåŒå…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
   - çŠ¶æ€è½¬æ¢æ§åˆ¶

2. **å®¡æ‰¹æµç¨‹å¼•æ“**
   - çµæ´»çš„æµç¨‹é…ç½®
   - å¤šçº§å®¡æ‰¹æ”¯æŒ

3. **æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶**
   - ç‰ˆæœ¬ç®¡ç†
   - å‘åå…¼å®¹

4. **æ¨¡å—åŒ–è®¾è®¡**
   - æ”¯æŒå¿«é€Ÿå®šåˆ¶
   - åŠŸèƒ½ç‹¬ç«‹

### å¸¸è§é¢è¯•é¢˜

1. åˆåŒå®¡æ‰¹æµç¨‹æ˜¯å¦‚ä½•è®¾è®¡çš„ï¼Ÿ
2. çŠ¶æ€æœºåœ¨é¡¹ç›®ä¸­å¦‚ä½•åº”ç”¨ï¼Ÿ
3. æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
4. åˆåŒå˜é‡æ›¿æ¢æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
5. æ¨¡å—åŒ–è®¾è®¡çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ
6. ä½ æ˜¯å¦‚ä½•ç”³è¯·ä¸“åˆ©çš„ï¼Ÿ

---

**æ›´æ–°è¿›åº¦åˆ°å­¦ä¹ è¿›åº¦.md**