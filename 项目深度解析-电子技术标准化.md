# é¡¹ç›®æ·±åº¦è§£æ - ç”µå­æŠ€æœ¯æ ‡å‡†åŒ–

> æ–‡æ¡£å¤„ç†ä¸æ™ºèƒ½æ£€ç´¢ç³»ç»Ÿ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**ï¼šæ™ºèƒ½ç”µå­æŠ€æœ¯æ ‡å‡†åŒ–  
**é¡¹ç›®è§’è‰²**ï¼šåç«¯ç ”å‘å·¥ç¨‹å¸ˆ  
**å¼€å‘æ—¶é—´**ï¼š2025.01 - è‡³ä»Š  
**æŠ€æœ¯æ ˆ**ï¼šJavaã€Spring Bootã€MySQLã€PostgreSQL + Pgvectorã€å¤šçº¿ç¨‹ç¼–ç¨‹  

---

## ğŸ¯ é¡¹ç›®èƒŒæ™¯ä¸ç›®æ ‡

### èƒŒæ™¯

æ–‡æ¡£å¤„ç†éœ€è¦å¤§é‡äººå·¥æ“ä½œï¼Œæ•ˆç‡ä½ä¸‹ï¼š
- äººå·¥æå–æ•°æ®ï¼š5å°æ—¶/æ–‡æ¡£
- ä¼ ç»Ÿæ£€ç´¢å‡†ç¡®æ€§å·®
- ç¼ºä¹æ™ºèƒ½åˆ†ç±»

### ç›®æ ‡

- å®ç°æ–‡æ¡£è‡ªåŠ¨è§£æ
- è¯¾é¢˜ä¸æŒ‡å—æ•°æ®æ™ºèƒ½åŒ–å¤„ç†
- åŸºäºå‘é‡æ£€ç´¢å®ç°ç›¸å…³æ€§æ’åº
- å¤§å¹…æå‡å¤„ç†æ•ˆç‡

---

## ğŸ”‘ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ–‡æ¡£è‡ªåŠ¨è§£æ

#### è§£æç­–ç•¥

```java
public interface DocumentParser {
    Document parse(String filePath) throws ParseException;
}

@Component
public class PdfParser implements DocumentParser {
    
    @Override
    public Document parse(String filePath) {
        PDDocument document = PDDocument.load(new File(filePath));
        String text = extractText(document);
        
        Document doc = new Document();
        doc.setTitle(extractTitle(text));
        doc.setContent(text);
        doc.setKeywords(extractKeywords(text));
        
        return doc;
    }
}
```

### 2. å¤šçº¿ç¨‹å¹¶å‘å¤„ç†

#### çº¿ç¨‹æ± å¤„ç†

```java
@Service
public class DocumentBatchProcessor {
    
    private ThreadPoolExecutor executor = new ThreadPoolExecutor(
        4, 10, 60, TimeUnit.SECONDS,
        new LinkedBlockingQueue<>(100)
    );
    
    public List<ProcessResult> process(List<Document> documents) {
        CountDownLatch latch = new CountDownLatch(documents.size());
        List<ProcessResult> results = Collections.synchronizedList(new ArrayList<>());
        
        for (Document doc : documents) {
            executor.submit(() -> {
                try {
                    ProcessResult result = processDocument(doc);
                    results.add(result);
                } catch (Exception e) {
                    log.error("å¤„ç†å¤±è´¥", e);
                } finally {
                    latch.countDown();
                }
            });
        }
        
        latch.await();
        return results;
    }
}
```

### 3. Pgvectorå‘é‡æ£€ç´¢

#### å‘é‡åŒ–

```java
@Service
public class EmbeddingService {
    
    public float[] generateEmbedding(String text) {
        List<String> sentences = splitSentences(text);
        
        float[] embedding = new float[1536];
        
        for (int i = 0; i < sentences.size() && i < 3; i++) {
            float[] sentEmbed = callEmbeddingApi(sentences.get(i));
            for (int j = 0; j < 1536; j++) {
                embedding[j] += sentEmbed[j];
            }
        }
        
        float avg = sentences.size();
        for (int i = 0; i < 1536; i++) {
            embedding[i] /= avg;
        }
        
        return embedding;
    }
}
```

#### å‘é‡æ£€ç´¢

```java
@Service
public class VectorSearchService {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    public List<Document> search(String query, int limit) {
        float[] embedding = embeddingService.generate(query);
        String vectorStr = arrayToVectorString(embedding);
        
        String sql = "SELECT id, title, content, " +
                      "1 - (embedding <=> ?) as similarity " +
                      "FROM document " +
                      "ORDER BY embedding <=> ? " +
                      "LIMIT ?";
        
        return jdbcTemplate.query(sql, new Object[]{vectorStr, vectorStr, limit},
            (rs, rowNum) -> {
                Document doc = new Document();
                doc.setId(rs.getLong("id"));
                doc.setTitle(rs.getString("title"));
                doc.setContent(rs.getString("content"));
                doc.setSimilarity(rs.getDouble("similarity"));
                return doc;
            });
    }
}
```

---

## ğŸ“Š æ ¸å¿ƒæˆæœ

- æ–‡æ¡£å¤„ç†æ•ˆç‡æå‡10å€
- äººå·¥æ“ä½œä»5å°æ—¶ç¼©çŸ­è‡³1å°æ—¶
- å®ç°10ä¸‡+æ•°æ®çš„å¿«é€Ÿæ£€ç´¢
- æ£€ç´¢å‡†ç¡®æ€§å¤§å¹…æå‡

---

## ğŸ“ é¢è¯•é‡ç‚¹

### æŠ€æœ¯äº®ç‚¹

1. **å¤šçº¿ç¨‹å¹¶å‘å¤„ç†**
2. **å‘é‡æ£€ç´¢**
3. **æ–‡æ¡£è‡ªåŠ¨è§£æ**

### å¸¸è§é¢è¯•é¢˜

1. æ–‡æ¡£è‡ªåŠ¨è§£ææ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
2. Pgvectorå‘é‡æ£€ç´¢æ˜¯å¦‚ä½•åº”ç”¨çš„ï¼Ÿ
3. å¤šçº¿ç¨‹åœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ

---

**æ›´æ–°è¿›åº¦åˆ°å­¦ä¹ è¿›åº¦.md**